<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platformer - Retro Arcade</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/games.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap">
    <style>
        #game-container {
            width: 800px;
            height: 500px;
            margin: 0 auto;
            background-color: #000;
            position: relative;
            border: 5px solid #00ff00;
            box-shadow: 0 0 20px #00ff00;
            overflow: hidden;
        }
        
        #game-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 20px;
        }
        
        .control-btn {
            width: 60px;
            height: 60px;
            background-color: #222;
            border: 3px solid #00ff00;
            color: #00ff00;
            font-size: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            user-select: none;
            box-shadow: 0 0 10px #00ff00;
        }
        
        .control-btn:active {
            background-color: #00ff00;
            color: #000;
        }
        
        .mobile-controls {
            display: none;
        }
        
        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            display: none;
        }
        
        .game-over h2 {
            color: #ff0000;
            font-size: 36px;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #ff0000;
        }
        
        .game-over p {
            color: #fff;
            font-size: 24px;
            margin-bottom: 30px;
        }
        
        .game-over button {
            padding: 10px 20px;
            background-color: #00ff00;
            color: #000;
            border: none;
            font-family: 'Press Start 2P', cursive;
            font-size: 18px;
            cursor: pointer;
        }
        
        @media (max-width: 850px) {
            #game-container {
                width: 100%;
                max-width: 500px;
                height: 300px;
            }
            
            .mobile-controls {
                display: flex;
            }
        }
    </style>
</head>
<body>
    <div class="background-container">
        <div class="stars"></div>
    </div>

    <header>
        <h1 class="neon-title">Platformer</h1>
        <a href="../index.html" class="back-btn">← Back to Arcade</a>
    </header>

    <main>
        <div id="score-display">Score: <span id="score">0</span></div>
        
        <div id="game-container">
            <canvas id="game-canvas"></canvas>
            
            <div class="game-over" id="game-over">
                <h2>Game Over!</h2>
                <p>Score: <span id="final-score">0</span></p>
                <button id="restart-btn">Play Again</button>
            </div>
        </div>
        
        <div class="controls mobile-controls">
            <div class="control-btn" id="left-btn">←</div>
            <div class="control-btn" id="jump-btn">↑</div>
            <div class="control-btn" id="right-btn">→</div>
        </div>
    </main>

    <footer>
        <p>&copy; 2023 Retro Arcade | All games playable in browser</p>
    </footer>

    <audio id="jump-sound" src="../assets/audio/hit.mp3" preload="auto"></audio>
    <audio id="coin-sound" src="../assets/audio/score.mp3" preload="auto"></audio>
    <audio id="death-sound" src="../assets/audio/explosion.mp3" preload="auto"></audio>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Game elements
            const canvas = document.getElementById('game-canvas');
            const ctx = canvas.getContext('2d');
            const scoreDisplay = document.getElementById('score');
            const finalScoreDisplay = document.getElementById('final-score');
            const gameOverScreen = document.getElementById('game-over');
            const restartBtn = document.getElementById('restart-btn');
            const leftBtn = document.getElementById('left-btn');
            const rightBtn = document.getElementById('right-btn');
            const jumpBtn = document.getElementById('jump-btn');
            
            // Sound elements
            const jumpSound = document.getElementById('jump-sound');
            const coinSound = document.getElementById('coin-sound');
            const deathSound = document.getElementById('death-sound');
            
            // Set canvas size
            function resizeCanvas() {
                canvas.width = canvas.parentElement.clientWidth;
                canvas.height = canvas.parentElement.clientHeight;
            }
            
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // Game variables
            let gameActive = true;
            let score = 0;
            let animationFrameId;
            
            // Player variables
            const player = {
                x: 50,
                y: 0,
                width: 30,
                height: 30,
                velocityX: 0,
                velocityY: 0,
                speed: 5,
                jumpPower: 12,
                gravity: 0.5,
                isJumping: false,
                color: '#ff0000'
            };
            
            // Platform variables
            let platforms = [];
            
            // Coin variables
            let coins = [];
            
            // Enemy variables
            let enemies = [];
            
            // Controls
            const keys = {
                left: false,
                right: false,
                up: false
            };
            
            // Initialize game
            function initGame() {
                gameActive = true;
                score = 0;
                scoreDisplay.textContent = score;
                gameOverScreen.style.display = 'none';
                
                // Reset player
                player.x = 50;
                player.y = 0;
                player.velocityX = 0;
                player.velocityY = 0;
                player.isJumping = false;
                
                // Create platforms
                createPlatforms();
                
                // Create coins
                createCoins();
                
                // Create enemies
                createEnemies();
                
                // Start game loop
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                }
                gameLoop();
            }
            
            // Create platforms
            function createPlatforms() {
                platforms = [
                    // Ground
                    { x: 0, y: canvas.height - 20, width: canvas.width, height: 20, color: '#008800' },
                    // Platforms
                    { x: 200, y: canvas.height - 100, width: 100, height: 15, color: '#008800' },
                    { x: 400, y: canvas.height - 150, width: 100, height: 15, color: '#008800' },
                    { x: 600, y: canvas.height - 200, width: 100, height: 15, color: '#008800' },
                    { x: 300, y: canvas.height - 250, width: 100, height: 15, color: '#008800' },
                    { x: 100, y: canvas.height - 300, width: 100, height: 15, color: '#008800' },
                    { x: 500, y: canvas.height - 350, width: 100, height: 15, color: '#008800' }
                ];
            }
            
            // Create coins
            function createCoins() {
                coins = [
                    { x: 230, y: canvas.height - 130, width: 15, height: 15, color: '#ffff00', collected: false },
                    { x: 430, y: canvas.height - 180, width: 15, height: 15, color: '#ffff00', collected: false },
                    { x: 630, y: canvas.height - 230, width: 15, height: 15, color: '#ffff00', collected: false },
                    { x: 330, y: canvas.height - 280, width: 15, height: 15, color: '#ffff00', collected: false },
                    { x: 130, y: canvas.height - 330, width: 15, height: 15, color: '#ffff00', collected: false },
                    { x: 530, y: canvas.height - 380, width: 15, height: 15, color: '#ffff00', collected: false }
                ];
            }
            
            // Create enemies
            function createEnemies() {
                enemies = [
                    { x: 250, y: canvas.height - 120, width: 20, height: 20, color: '#00ff00', velocityX: 1, range: 50, startX: 250 },
                    { x: 450, y: canvas.height - 170, width: 20, height: 20, color: '#00ff00', velocityX: 1, range: 50, startX: 450 },
                    { x: 650, y: canvas.height - 220, width: 20, height: 20, color: '#00ff00', velocityX: 1, range: 50, startX: 650 }
                ];
            }
            
            // Update player
            function updatePlayer() {
                // Apply gravity
                player.velocityY += player.gravity;
                
                // Apply horizontal movement
                if (keys.left) {
                    player.velocityX = -player.speed;
                } else if (keys.right) {
                    player.velocityX = player.speed;
                } else {
                    player.velocityX = 0;
                }
                
                // Apply jump
                if (keys.up && !player.isJumping) {
                    player.velocityY = -player.jumpPower;
                    player.isJumping = true;
                    
                    jumpSound.currentTime = 0;
                    jumpSound.play().catch(e => console.log('Audio play error:', e));
                }
                
                // Update position
                player.x += player.velocityX;
                player.y += player.velocityY;
                
                // Check platform collisions
                player.isJumping = true;
                
                for (let i = 0; i < platforms.length; i++) {
                    const platform = platforms[i];
                    
                    // Check if player is on platform
                    if (player.x + player.width > platform.x &&
                        player.x < platform.x + platform.width &&
                        player.y + player.height > platform.y &&
                        player.y + player.height < platform.y + platform.height + player.velocityY) {
                        
                        player.y = platform.y - player.height;
                        player.velocityY = 0;
                        player.isJumping = false;
                    }
                }
                
                // Check boundaries
                if (player.x < 0) {
                    player.x = 0;
                } else if (player.x + player.width > canvas.width) {
                    player.x = canvas.width - player.width;
                }
                
                // Check if player fell off the screen
                if (player.y > canvas.height) {
                    gameOver();
                }
            }
            
            // Update coins
            function updateCoins() {
                for (let i = 0; i < coins.length; i++) {
                    const coin = coins[i];
                    
                    if (!coin.collected && 
                        player.x + player.width > coin.x &&
                        player.x < coin.x + coin.width &&
                        player.y + player.height > coin.y &&
                        player.y < coin.y + coin.height) {
                        
                        coin.collected = true;
                        score += 10;
                        scoreDisplay.textContent = score;
                        
                        coinSound.currentTime = 0;
                        coinSound.play().catch(e => console.log('Audio play error:', e));
                    }
                }
            }
            
            // Update enemies
            function updateEnemies() {
                for (let i = 0; i < enemies.length; i++) {
                    const enemy = enemies[i];
                    
                    // Move enemy back and forth
                    enemy.x += enemy.velocityX;
                    
                    if (enemy.x > enemy.startX + enemy.range || enemy.x < enemy.startX - enemy.range) {
                        enemy.velocityX *= -1;
                    }
                    
                    // Check collision with player
                    if (player.x + player.width > enemy.x &&
                        player.x < enemy.x + enemy.width &&
                        player.y + player.height > enemy.y &&
                        player.y < enemy.y + enemy.height) {
                        
                        gameOver();
                    }
                }
            }
            
            // Game over
            function gameOver() {
                gameActive = false;
                finalScoreDisplay.textContent = score;
                gameOverScreen.style.display = 'flex';
                
                deathSound.currentTime = 0;
                deathSound.play().catch(e => console.log('Audio play error:', e));
            }
            
            // Draw game
            function drawGame() {
                // Clear canvas
                ctx.fillStyle = '#87CEEB'; // Sky blue background
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Draw platforms
                for (let i = 0; i < platforms.length; i++) {
                    const platform = platforms[i];
                    ctx.fillStyle = platform.color;
                    ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                }
                
                // Draw coins
                for (let i = 0; i < coins.length; i++) {
                    const coin = coins[i];
                    if (!coin.collected) {
                        ctx.fillStyle = coin.color;
                        ctx.beginPath();
                        ctx.arc(coin.x + coin.width / 2, coin.y + coin.height / 2, coin.width / 2, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
                
                // Draw enemies
                for (let i = 0; i < enemies.length; i++) {
                    const enemy = enemies[i];
                    ctx.fillStyle = enemy.color;
                    ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
                    
                    // Draw eyes
                    ctx.fillStyle = '#ff0000';
                    ctx.fillRect(enemy.x + 4, enemy.y + 5, 4, 4);
                    ctx.fillRect(enemy.x + enemy.width - 8, enemy.y + 5, 4, 4);
                }
                
                // Draw player
                ctx.fillStyle = player.color;
                ctx.fillRect(player.x, player.y, player.width, player.height);
                
                // Draw player face
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(player.x + 5, player.y + 8, 5, 5);
                ctx.fillRect(player.x + player.width - 10, player.y + 8, 5, 5);
                
                ctx.fillStyle = '#000000';
                ctx.fillRect(player.x + 15, player.y + 20, 10, 3);
            }
            
            // Game loop
            function gameLoop() {
                if (gameActive) {
                    updatePlayer();
                    updateCoins();
                    updateEnemies();
                    drawGame();
                    animationFrameId = requestAnimationFrame(gameLoop);
                }
            }
            
            // Event listeners
            window.addEventListener('keydown', (e) => {
                switch (e.key) {
                    case 'ArrowLeft':
                    case 'a':
                        keys.left = true;
                        break;
                    case 'ArrowRight':
                    case 'd':
                        keys.right = true;
                        break;
                    case 'ArrowUp':
                    case 'w':
                    case ' ':
                        keys.up = true;
                        break;
                }
            });
            
            window.addEventListener('keyup', (e) => {
                switch (e.key) {
                    case 'ArrowLeft':
                    case 'a':
                        keys.left = false;
                        break;
                    case 'ArrowRight':
                    case 'd':
                        keys.right = false;
                        break;
                    case 'ArrowUp':
                    case 'w':
                    case ' ':
                        keys.up = false;
                        break;
                }
            });
            
            // Touch controls
            leftBtn.addEventListener('touchstart', () => { keys.left = true; });
            leftBtn.addEventListener('touchend', () => { keys.left = false; });
            leftBtn.addEventListener('mousedown', () => { keys.left = true; });
            leftBtn.addEventListener('mouseup', () => { keys.left = false; });
            
            rightBtn.addEventListener('touchstart', () => { keys.right = true; });
            rightBtn.addEventListener('touchend', () => { keys.right = false; });
            rightBtn.addEventListener('mousedown', () => { keys.right = true; });
            rightBtn.addEventListener('mouseup', () => { keys.right = false; });
            
            jumpBtn.addEventListener('touchstart', () => { keys.up = true; });
            jumpBtn.addEventListener('touchend', () => { keys.up = false; });
            jumpBtn.addEventListener('mousedown', () => { keys.up = true; });
            jumpBtn.addEventListener('mouseup', () => { keys.up = false; });
            
            // Restart button
            restartBtn.addEventListener('click', initGame);
            
            // Start game
            initGame();
        });
    </script>
</body>
</html>